$(document).ready(function(){builder.reArrangeLayout(),builder.triggerDragnDrop()});var builder={triggerDragnDrop:function(){$(".droparea").sortable({placeholder:"ui-state-highlight",connectWith:".droparea",items:".moveable",receive:function(){var o=$(this).closest(".main-column").find(".main-col-pos").val(),s=$(this).closest(".widget-row").find(".main-row-pos").val(),a=$(this).closest(".column-area").find(".sub-col-pos").val(),l=$(this).closest(".sub-row").find(".sub-row-pos").val();$(this).find(".module-in-main-row").val(s),$(this).find(".module-in-main-col").val(o),$(this).find(".module-in-sub-row").val(l),$(this).find(".module-in-sub-col").val(a)},stop:function(){builder.reArrangeLayout()}}).droppable({accept:".moveable"}),$(".widget-container").sortable({placeholder:"ui-state-highlight",stop:function(){builder.reArrangeLayout()}})},plusMainColumn:function(o){var s=parseInt(o.closest(".col-count").find(".count").text());if(s<12){s<4?s++:s>=4&&s<6?s=6:s>=6&&(s=12),o.closest(".col-count").find(".count").html(s);var a=o.closest(".widget-row").find(".row-content");builder.divideMainColumn(s,a)}builder.triggerDragnDrop()},plusSubColumn:function(o){var s=parseInt(o.closest(".sub-col-count").find(".count").text());if(s<12){s<4?s++:s>=4&&s<6?s=6:s>=6&&(s=12),o.closest(".sub-col-count").find(".count").html(s);var a=o.closest(".sub-row").find(".sub-row-content");builder.divideSubColumn(s,a)}builder.triggerDragnDrop()},minusMainColumn:function(o){var s=parseInt(o.closest(".col-count").find(".count").text());if(s>1){s<=12&&s>6?s=6:s<=6&&s>4?s=4:s<=4&&s--,o.closest(".col-count").find(".count").html(s);var a=o.closest(".widget-row").find(".row-content");builder.divideMainColumn(s,a)}builder.triggerDragnDrop()},minusSubColumn:function(o){var s=parseInt(o.closest(".sub-col-count").find(".count").text());if(s>1){s<=12&&s>6?s=6:s<=6&&s>4?s=4:s<=4&&s--,o.closest(".sub-col-count").find(".count").html(s);var a=o.closest(".sub-row").find(".sub-row-content");builder.divideSubColumn(s,a)}builder.triggerDragnDrop()},customMainColumns:function(o){var s=o.closest(".widget-row").find(".row-content");builder.setUpMainColumns(s),builder.triggerDragnDrop()},customSubColumns:function(o){var s=o.closest(".sub-row").find(".sub-row-content");builder.setUpSubColumns(s),builder.triggerDragnDrop()},divideMainColumn:function(o,s){switch(o){case 1:builder.drawMainColumns("12",s);break;case 2:builder.drawMainColumns("6 + 6",s);break;case 3:builder.drawMainColumns("4 + 4 + 4",s);break;case 4:builder.drawMainColumns("3 + 3 + 3 + 3",s);break;case 6:builder.drawMainColumns("2 + 2 + 2 + 2 + 2 + 2",s);break;case 12:builder.drawMainColumns("1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1",s)}builder.triggerDragnDrop()},divideSubColumn:function(o,s){switch(o){case 1:builder.drawSubColumns("12",s);break;case 2:builder.drawSubColumns("6 + 6",s);break;case 3:builder.drawSubColumns("4 + 4 + 4",s);break;case 4:builder.drawSubColumns("3 + 3 + 3 + 3",s);break;case 6:builder.drawSubColumns("2 + 2 + 2 + 2 + 2 + 2",s);break;case 12:builder.drawSubColumns("1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1",s)}builder.triggerDragnDrop()},setUpSubColumns:function(o){var s=o.closest(".sub-row").find(".sub-cols-format").val(),a=$("#text-custom-columns").val(),l=prompt(a,s);null!==l&&builder.drawSubColumns(l,o),builder.triggerDragnDrop()},setUpMainColumns:function(o){var s=o.closest(".widget-row").find(".cols-format").val(),a=$("#text-custom-columns").val(),l=prompt(a,s);null!==l&&builder.drawMainColumns(l,o),builder.triggerDragnDrop()},drawSubColumns:function(o,s){var a="",l=0,i=0,e=!1,t=s.closest(".widget-row").find(".main-row-pos").val(),n=s.closest(".main-column").find(".main-col-pos").val(),u=s.closest(".sub-row").find(".sub-row-pos").val(),c=$("#text-add-module").val(),r=$("#text-columns-error-format").val(),d=o.split("+").map(function(o){return o.trim()});if(d){var m=d.length;d.forEach(function(o){"0"!=o?l+=parseInt(o):l=13}),12==l&&(e=!0),e?(d.forEach(function(o){s.has(".sub-col-"+i+" .layout-module-info").length?(a+=' <div class="col-sm-'+o+' column-area">',a+=' <div class="module-area droparea ui-droppable ui-sortable sub-col-'+i+'">',a+=s.find(".sub-col-"+i).html(),a+=" </div>",a+=' <input type="hidden" class="sub-col-pos" value="'+i+'" />',a+=' <input type="hidden" class="sub-col-format" name="widget['+t+"][main_cols]["+n+"][sub_rows]["+u+"][sub_cols]["+i+'][format]" value="'+o+'" />',a+=" </div>",i++):(a+=' <div class="col-sm-'+o+' column-area">',a+=' <div class="module-area droparea ui-droppable ui-sortable sub-col-'+i+'">',a+=' <div class="col-action">',a+=' <div class="action-group">',a+=' <a class="a-module-add" title="'+c+'" onclick="builder.showAllModules($(this))" href="javascript:void(0);"><i class="fa fa-plus"></i></a>',a+=" </div>",a+=" </div>",a+=" </div>",a+=' <input type="hidden" class="sub-col-pos" value="'+i+'" />',a+=' <input type="hidden" class="sub-col-format" name="widget['+t+"][main_cols]["+n+"][sub_rows]["+u+"][sub_cols]["+i+'][format]" value="'+o+'" />',a+=" </div>",i++)}),s.closest(".sub-row").find(".count").html(m),s.closest(".sub-row").find(".sub-cols-format").val(o),s.html(a)):alert(r)}else alert(r);builder.triggerDragnDrop()},drawMainColumns:function(o,s){var a="",l=0,i=0,e=!1,t=s.closest(".widget-row").find(".main-row-pos").val(),n=$("#text-add-module").val(),u=$("#text-add-sub-row").val(),c=$("#text-columns-error-format").val(),r=$("#text-custom-columns").val(),d=o.split("+").map(function(o){return o.trim()});if(d){var m=d.length;d.forEach(function(o){"0"!=o?l+=parseInt(o):l=13}),12==l&&(e=!0),e?(d.forEach(function(o){s.has(".main-col-"+i+" .sub-row").length?(a+='<div class="col-sm-'+o+' main-column">',a+=' <input type="hidden" class="main-col-pos" value="'+i+'" />',a+=' <input type="hidden" class="main-col-format" value="'+o+'" name="widget['+t+"][main_cols]["+i+'][format]" />',a+=' <div class="main-col-content main-col-'+i+'">',a+=s.find(".main-col-"+i).html(),a+=" </div>",a+=' <div class="sub-row-add">',a+=' <a class="a-sub-row-add" title="'+u+'" href="javascript:void(0);" onclick="builder.drawSubRow($(this))"><i class="fa fa-plus-square"></i></a>',a+=" </div>",a+="</div>",i++):(a+='<div class="col-sm-'+o+' main-column">',a+=' <input type="hidden" class="main-col-pos" value="'+i+'" />',a+=' <input type="hidden" class="main-col-format" value="'+o+'" name="widget['+t+"][main_cols]["+i+'][format]" />',a+=' <div class="main-col-content main-col-'+i+'">',a+=' <div class="sub-row sub-row-0">',a+=' <div class="sub-row-action">',a+=' <div class="action-group">',a+=' <div class="sub-col-count">',a+=' <a href="javascript:void(0);" onclick="builder.plusSubColumn($(this))" rel="1" class="col-plus"></a>',a+=' <span class="count">1</span>',a+=' <a href="javascript:void(0);" onclick="builder.minusSubColumn($(this))" rel="1" class="col-minus"></a>',a+=" </div>",a+=' <div class="a-group">',a+=' <a class="a-column-custom" title="'+r+'" onclick="builder.customSubColumns($(this))" href="javascript:void(0);"></a>',a+=' <a class="a-row-delete" onclick="builder.removeSubRow($(this))" href="javascript:void(0);"></a>',a+=" </div>",a+=" </div>",a+=' <input type="hidden" class="sub-cols-format" value="12" />',a+=" </div>",a+=' <div class="sub-row-content">',a+=' <div class="col-sm-12 column-area">',a+=' <div class="module-area droparea ui-droppable ui-sortable sub-col-0">',a+=' <div class="col-action">',a+=' <div class="action-group">',a+=' <a class="a-module-add" title="'+n+'" onclick="builder.showAllModules($(this))" href="javascript:void(0);"><i class="fa fa-plus"></i></a>',a+=" </div>",a+=" </div>",a+=" </div>",a+=' <input type="hidden" class="sub-col-pos" value="0" />',a+=' <input type="hidden" class="sub-col-format" name="widget['+t+"][main_cols]["+i+'][sub_rows][0][sub_cols][0][format]" value="12" />',a+=" </div>",a+=" </div>",a+=' <input type="hidden" class="sub-row-pos" value="0" />',a+=" </div>",a+=" </div>",a+=' <div class="sub-row-add">',a+=' <a class="a-sub-row-add" title="'+u+'" href="javascript:void(0);" onclick="builder.drawSubRow($(this))"><i class="fa fa-plus-square"></i></a>',a+=" </div>",a+="</div>",i++)}),s.closest(".widget-row").find(".count").html(m),s.closest(".widget-row").find(".cols-format").val(o),s.html(a)):alert(c)}else alert(c);builder.triggerDragnDrop()},drawSubRow:function(o){var s="",a=$("#text-add-module").val(),l=$("#text-custom-columns").val(),i=o.closest(".main-column"),e=o.closest(".widget-row").find(".main-row-pos").val(),t=i.find(".main-col-pos").val(),n=i.find(".main-col-"+t).find(".sub-row:last .sub-row-pos").val();null==n?n=0:n++,s+=' <div class="sub-row sub-row-'+n+'">',s+=' <div class="sub-row-action">',s+=' <div class="action-group">',s+=' <div class="sub-col-count">',s+=' <a href="javascript:void(0);" onclick="builder.plusSubColumn($(this))" rel="1" class="col-plus"></a>',s+=' <span class="count">1</span>',s+=' <a href="javascript:void(0);" onclick="builder.minusSubColumn($(this))" rel="1" class="col-minus"></a>',s+=" </div>",s+=' <div class="a-group">',s+=' <a class="a-column-custom" title="'+l+'" onclick="builder.customSubColumns($(this))" href="javascript:void(0);"></a>',s+=' <a class="a-row-delete" onclick="builder.removeSubRow($(this))" href="javascript:void(0);"></a>',s+=" </div>",s+=" </div>",s+=' <input type="hidden" class="sub-cols-format" value="12" />',s+=" </div>",s+=' <div class="sub-row-content">',s+=' <div class="col-sm-12 column-area">',s+=' <div class="module-area droparea ui-droppable ui-sortable sub-col-0">',s+=' <div class="col-action">',s+=' <div class="action-group">',s+=' <a class="a-module-add" title="'+a+'" onclick="builder.showAllModules($(this))" href="javascript:void(0);"><i class="fa fa-plus"></i></a>',s+=" </div>",s+=" </div>",s+=" </div>",s+=' <input type="hidden" class="sub-col-pos" value="0" />',s+=' <input type="hidden" class="sub-col-format" name="widget['+e+"][main_cols]["+t+"][sub_rows]["+n+'][sub_cols][0][format]" value="12" />',s+=" </div>",s+=" </div>",s+=' <input type="hidden" class="sub-row-pos" value="'+n+'" />',s+=" </div>",i.find(".main-col-"+t).append(s),builder.triggerDragnDrop()},drawMainRow:function(o){var s=$("#text-add-module").val(),a=$("#text-custom-columns").val(),l="";l+='<div class="widget-row col-sm-12">',l+=' <div class="row-action">',l+=' <div class="action-group">',l+=' <div class="col-count">',l+=' <a href="javascript:void(0);" onclick="builder.plusMainColumn($(this));" rel="1" class="col-plus"></a>',l+=' <span class="count" >1</span>',l+=' <a href="javascript:void(0);" onclick="builder.minusMainColumn($(this));" rel="1" class="col-minus"></a>',l+=" </div>",l+=' <div class="a-group">',l+=' <input type="text" class="form-control input-class-name" name="widget['+o+'][class]" value="" placeholder="'+$("#text-custom-classname").val()+'" />',l+=' <a class="a-column-custom" onclick="builder.customMainColumns($(this));" href="javascript:void(0);" title="'+a+'"></a>',l+=' <a class="a-row-delete" onclick="builder.removeRow($(this));" href="javascript:void(0);"></a>',l+=" </div>",l+=" </div>",l+=' <input type="hidden" class="cols-format" value="12" />',l+=" </div>",l+=' <div class="row-content row-'+o+'"> <div class="col-sm-12 main-column"> <input type="hidden" class="main-col-pos" value="0" /> <input type="hidden" class="main-col-format" name="widget['+o+'][main_cols][0][format]" value="12" /> <div class="main-col-content main-col-0"> <div class="sub-row sub-row-0"> <div class="sub-row-action"> <div class="action-group"> <div class="sub-col-count"> <a href="javascript:void(0);" onclick="builder.plusSubColumn($(this))" rel="1" class="col-plus"></a> <span class="count">1</span> <a href="javascript:void(0);" onclick="builder.minusSubColumn($(this))" rel="1" class="col-minus"></a> </div> <div class="a-group"> <a class="a-column-custom" onclick="builder.customSubColumns($(this))" href="javascript:void(0);" title="'+a+'"></a> <a class="a-row-delete" onclick="builder.removeSubRow($(this))" href="javascript:void(0);"></a> </div> </div> <input type="hidden" class="sub-cols-format" value="12" /> </div> <div class="sub-row-content"> <div class="col-sm-12 column-area"> <div class="module-area droparea ui-droppable ui-sortable sub-col-0"> <div class="col-action"><div class="action-group"> <a class="a-module-add" title="'+s+'" onclick="builder.showAllModules($(this))" href="javascript:void(0);"><i class="fa fa-plus"></i></a></div></div></div><input type="hidden" class="sub-col-pos" value="0" /> <input type="hidden" class="sub-col-format" name="widget['+o+'][main_cols][0][sub_rows][0][sub_cols][0][format]" value="12" /> </div></div><input type="hidden" class="sub-row-pos" value="0" /> </div></div><div class="sub-row-add"> <a class="a-sub-row-add" title="'+$("#text-add-sub-row").val()+'" href="javascript:void(0);" onclick="builder.drawSubRow($(this))"><i class="fa fa-plus-square"></i></a> </div></div></div><input type="hidden" class="main-row-pos" value="'+o+'" /></div>',$(".widget-container").append(l),builder.triggerDragnDrop()},removeSubRow:function(o){o.closest(".sub-row").remove(),builder.reArrangeLayout()},removeRow:function(o){o.closest(".widget-row").remove(),builder.reArrangeLayout()},showAllModules:function(o){var s=o.closest(".widget-row").find(".main-row-pos").val(),a=o.closest(".sub-row").find(".sub-row-pos").val(),l=o.closest(".main-column").find(".main-col-pos").val(),i=o.closest(".column-area").find(".sub-col-pos").val();$("#module-row").val(s),$("#module-col").val(l),$("#module-sub-row").val(a),$("#module-sub-col").val(i),$(".popup-background").show(),$(".popup-loader-img").show(),$(".all-modules-container").show(600),builder.triggerDragnDrop()},closeAllModules:function(){$(".all-modules-container").hide(600),$(".popup-background").hide(),$(".popup-loader-img").hide()},addModule:function(o,s,a){var l=$("#module-row").val(),i=$("#module-col").val(),e=$("#module-sub-row").val(),t=$("#module-sub-col").val();html='<div class="layout-module-info moveable">',html+='\t<div class="top">',html+='\t\t<div class="module-info">',html+="\t\t\t<p>"+o+"</p>",html+="\t\t</div>",html+='\t\t<div class="module-action">',html+='\t\t<a class="a-module-edit" href="javascript:void(0);" onclick="loadModule(\''+a+'\')"><i class="fa fa-pencil"></i></a>',html+='\t\t\t<a class="a-module-remove" href="javascript:void(0);" onclick="builder.removeModule($(this))"><i class="fa fa-times"></i></a>',html+="\t\t</div>",html+="\t</div>",html+='\t<input type="hidden" class="module-in-main-row" value="'+l+'" />',html+='\t<input type="hidden" class="module-in-main-col" value="'+i+'" />',html+='\t<input type="hidden" class="module-in-sub-row" value="'+e+'" />',html+='\t<input type="hidden" class="module-in-sub-col" value="'+t+'" />',html+='\t<input type="hidden" class="module-code" name="widget['+l+"][main_cols]["+i+"][sub_rows]["+e+"][sub_cols]["+t+'][info][module][0][code]" value="'+s+'" />',html+='\t<input type="hidden" class="module-name" name="widget['+l+"][main_cols]["+i+"][sub_rows]["+e+"][sub_cols]["+t+'][info][module][0][name]" value="'+o+'" />',html+='\t<input type="hidden" class="module-url" name="widget['+l+"][main_cols]["+i+"][sub_rows]["+e+"][sub_cols]["+t+'][info][module][0][url]" value="'+a+'" />',html+="</div>",$(".widget-container .row-"+l+" .main-col-"+i+" .sub-row-"+e+" .sub-col-"+t).append(html),builder.closeAllModules(),builder.reArrangeLayout(),builder.triggerDragnDrop()},removeModule:function(o){o.closest(".layout-module-info").remove(),builder.reArrangeLayout(),builder.triggerDragnDrop()},reArrangeLayout:function(){var o=0;$(".widget-container .widget-row").each(function(){$(this).find(".main-row-pos").val(o),$(this).find(".row-content").removeClass().addClass("row-content row-"+o),$(this).find(".input-class-name").attr("name","widget["+o+"][class]");var s=0;$(this).find(".main-column").each(function(){$(this).find(".main-col-pos").val(s),$(this).find(".main-col-content").removeClass().addClass("main-col-content main-col-"+s),$(this).find(".main-col-format").attr("name","widget["+o+"][main_cols]["+s+"][format]");var a=0;$(this).find(".sub-row").each(function(){$(this).find(".sub-row-pos").val(a),$(this).removeClass().addClass("sub-row sub-row-"+a);var l=0;$(this).find(".column-area").each(function(){$(this).find(".sub-col-pos").val(l),$(this).find(".sub-col-format").attr("name","widget["+o+"][main_cols]["+s+"][sub_rows]["+a+"][sub_cols]["+l+"][format]"),$(this).find(".module-area").removeClass().addClass("module-area droparea ui-droppable ui-sortable sub-col-"+l);var i=0;$(this).find(".layout-module-info").each(function(){$(this).find(".module-in-main-row").val(o),$(this).find(".module-in-main-col").val(s),$(this).find(".module-in-sub-row").val(a),$(this).find(".module-in-sub-sol").val(l),$(this).find(".module-code").attr("name","widget["+o+"][main_cols]["+s+"][sub_rows]["+a+"][sub_cols]["+l+"][info][module]["+i+"][code]"),$(this).find(".module-name").attr("name","widget["+o+"][main_cols]["+s+"][sub_rows]["+a+"][sub_cols]["+l+"][info][module]["+i+"][name]"),$(this).find(".module-url").attr("name","widget["+o+"][main_cols]["+s+"][sub_rows]["+a+"][sub_cols]["+l+"][info][module]["+i+"][url]"),i++}),l++}),a++}),s++}),o++})}};